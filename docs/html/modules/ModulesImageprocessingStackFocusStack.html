---
layout: default
---

<head>
    <link rel="stylesheet" href="../../css/index.css">
</head>

<body>
<!-- Side navigation -->
<div class="sidenav">
    <a href="../../index.html" class="nav1">Introduction</a>
    <a href="../gettingstarted.html" class="nav1">Getting started</a>
    <a href="../modulelist.html" class="nav1">Modules</a>
    <a href="../macrolist.html" class="nav1">Macros</a>
    <!-- <a href="../extendingmia.html" class="nav1">Extending MIA</a> -->
</div>

<!-- Page content -->
<div class="main">
    <!--The following is replaced automatically by the generated module list-->
    <a href="../modulelist.html">Back to module list</a>
<h1>Focus stack</h1>
<h2>Description</h2>
Focuses a Z-stack into a single plane using the StackFocuser Fiji plugin.  Best focus position is determined at each 2D pixel location, with the final image being comprised of the pixels from the slice with the best focus at that location.  Each channel and timepoint is focused separately.  Prior to application, the focus map can be median filtered to remove outliers.  Height maps can be stored and used in additional "Focus stack" instances, thus allowing height maps to be edited prior to use.<br><br>Uses the <a href="https://imagej.nih.gov/ij/plugins/download/Stack_Focuser_.java">StackFocuser</a> plugin created by Mikhail Umorin (source code downloaded on 06-June-2018).
<h2>Parameters</h2>
<ul><li><b>Input image</b> (default = "") Image stack from the workspace which will be focused into a single plane.</li><br><li><b>Output focused image</b> (default = "") Output focused image which will be added to the workspace.  This image will have the same number of channels and timepoints as the input image, but will always only have a single Z-slice.</li><br><li><b>Add height map image to workspace</b> (default = "false") When selected, the height map image will be added to the workspace with the name specified by "Output height image".  Since the height map image can be used as an input to the "FocusStack" module, the height map can be edited prior to being used to generate a focused image.</li><br><li><b>Output height image</b> (default = "") If "Add height map image to workspace" is selected, the height map will be added to the workspace with this name.  The height map image has a single slice and equal number of channels and timepoints to the input image.  The value of each pixel corresponds to the best-focused Z-position of the input stack.  Slice indices are zero-indexed (i.e. first slice has an index of 0).</li><br><li><b>Use existing height image</b> (default = "false") When selected, the height map image will be loaded from the workspace ("Input height image" parameter) rather than being calculated based on the input image.</li><br><li><b>Input height image</b> (default = "") The name of the height map image in the workspace if the height map has been pre-determined.</li><br><li><b>Range</b> (default = "11") If calculating a new height image ("Use existing height image" parameter isn't selected), the best focus slice at each pixel will be based on pixel intensities within this range (specified in pixel units).</li><br><li><b>Smooth height map</b> (default = "true") When selected, the height map will be passed through a 2D median filter (range specified by "Range" parameter) to remove outliers.</li><br></ul>

</div>
</body>